/*
 * Sentilab SARE: a Sentiment Analysis Research Environment
 * Copyright (C) 2013 Sabanci University Sentilab
 * http://sentilab.sabanciuniv.edu
 * 
 * This file is part of SARE.
 * 
 * SARE is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *  
 * SARE is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with SARE. If not, see <http://www.gnu.org/licenses/>.
 *
 * This file is a modified version of jqplot.highlighter.js, which is part of
 * the jqPlot library by Chris Leonello.
 * 
 * Full (unminified) version can be obtained from: https://gist.github.com/musabhusaini/0053d6af92609c3f59cc.
 * 
 * Original copyright statement follows.
 * 
 */

/** 
 * jqPlot
 * Pure JavaScript plotting plugin using jQuery
 *
 * Version: @VERSION
 * Revision: @REVISION
 *
 * Copyright (c) 2009-2013 Chris Leonello
 * jqPlot is currently available for use in all personal or commercial projects 
 * under both the MIT (http://www.opensource.org/licenses/mit-license.php) and GPL 
 * version 2.0 (http://www.gnu.org/licenses/gpl-2.0.html) licenses. This means that you can 
 * choose the license that best suits your project and use it accordingly. 
 *
 * Although not required, the author would appreciate an email letting him 
 * know of any substantial use of jqPlot.  You can reach the author at: 
 * chris at jqplot dot com or see http://www.jqplot.com/info.php .
 *
 * If you are feeling kind and generous, consider supporting the project by
 * making a donation at: http://www.jqplot.com/donate.php .
 *
 * sprintf functions contained in jqplot.sprintf.js by Ash Searle:
 *
 *     version 2007.04.27
 *     author Ash Searle
 *     http://hexmen.com/blog/2007/03/printf-sprintf/
 *     http://hexmen.com/js/sprintf.js
 *     The author (Ash Searle) has placed this code in the public domain:
 *     "This code is unrestricted: you are free to use it however you like."
 * 
 */
(function(e){e.jqplot.eventListenerHooks.push(["jqplotClick",c]);e.jqplot.PermHighlighter=function(h){this.show=e.jqplot.config.enablePlugins;this.markerRenderer=new e.jqplot.MarkerRenderer({shadow:false});this.showMarker=true;this.lineWidthAdjust=2.5;this.sizeAdjust=5;this.showTooltip=false;this.tooltipLocation="nw";this.fadeTooltip=true;this.tooltipFadeSpeed="fast";this.tooltipOffset=2;this.tooltipAxes="both";this.tooltipSeparator=", ";this.tooltipContentEditor=null;this.useAxesFormatters=true;this.tooltipFormatString="%.5P";this.formatString=null;this.yvalues=1;this.bringSeriesToFront=false;this._tooltipElem=null;this.isHighlighting=false;this.currentNeighbor=null;this.initial=null;e.extend(true,this,h)};var b=["nw","n","ne","e","se","s","sw","w"];var f={nw:0,n:1,ne:2,e:3,se:4,s:5,sw:6,w:7};var d=["se","s","sw","w","nw","n","ne","e"];e.jqplot.PermHighlighter.init=function(k,j,i){var h=i||{};this.plugins.permHighlighter=new e.jqplot.PermHighlighter(h.permHighlighter)};e.jqplot.PermHighlighter.parseOptions=function(i,h){this.showHighlight=true;this.initial=null};e.jqplot.PermHighlighter.postPlotDraw=function(){if(this.plugins.permHighlighter&&this.plugins.permHighlighter.highlightCanvas){this.plugins.permHighlighter.highlightCanvas.resetCanvas();this.plugins.permHighlighter.highlightCanvas=null}if(this.plugins.permHighlighter&&this.plugins.permHighlighter._tooltipElem){this.plugins.permHighlighter._tooltipElem.emptyForce();this.plugins.permHighlighter._tooltipElem=null}this.plugins.permHighlighter.highlightCanvas=new e.jqplot.GenericCanvas();this.eventCanvas._elem.before(this.plugins.permHighlighter.highlightCanvas.createElement(this._gridPadding,"jqplot-highlight-canvas",this._plotDimensions,this));this.plugins.permHighlighter.highlightCanvas.setContext();var h=document.createElement("div");this.plugins.permHighlighter._tooltipElem=e(h);h=null;this.plugins.permHighlighter._tooltipElem.addClass("jqplot-highlighter-tooltip");this.plugins.permHighlighter._tooltipElem.css({position:"absolute",display:"none"});this.eventCanvas._elem.before(this.plugins.permHighlighter._tooltipElem);if(this.plugins.permHighlighter.initial){this.plugins.permHighlighter.highlight(this.plugins.permHighlighter.initial,this)}};e.jqplot.PermHighlighter.prototype.highlight=function(l,k){if(l&&e.isArray(l.data)&&l.seriesIndex>=0){if(!l.pointIndex||!l.gridData){var j;var h=k.series[l.seriesIndex];for(j=0;j<h.data.length;j++){if(l.data[0]===h.data[j][0]&&(l.data[1]==null||l.data[1]==undefined||l.data[1]===h.data[j][1])){l.data[1]=h.data[j][0];break}}if(j<h.data.length){l.pointIndex=j;l.gridData=h.gridData[j]}}}else{return false}var m=k.plugins.cursor;this.isHighlighting=true;this.currentNeighbor=l;if(this.showMarker){a(k,l)}if(k.series[l.seriesIndex].show&&this.showTooltip&&(!m||!m._zoom.started)){g(k,k.series[l.seriesIndex],l)}if(this.bringSeriesToFront){k.moveSeriesToFront(l.seriesIndex)}};e.jqplot.preInitHooks.push(e.jqplot.PermHighlighter.init);e.jqplot.preParseSeriesOptionsHooks.push(e.jqplot.PermHighlighter.parseOptions);e.jqplot.postDrawHooks.push(e.jqplot.PermHighlighter.postPlotDraw);function a(m,o){var j=m.plugins.permHighlighter;var p=m.series[o.seriesIndex];var h=p.markerRenderer;var i=j.markerRenderer;i.style=h.style;i.lineWidth=h.lineWidth+j.lineWidthAdjust;i.size=h.size+j.sizeAdjust;var l=e.jqplot.getColorComponents(h.color);var n=[l[0],l[1],l[2]];var k=(l[3]>=0.6)?l[3]*0.6:l[3]*(2-l[3]);i.color="rgba("+n[0]+","+n[1]+","+n[2]+","+k+")";i.init();i.draw(p.gridData[o.pointIndex][0],p.gridData[o.pointIndex][1],j.highlightCanvas._ctx)}function g(A,q,m){var k=A.plugins.permHighlighter;var D=k._tooltipElem;var r=q.permHighlighter||{};var t=e.extend(true,{},k,r);if(t.useAxesFormatters){var w=q._xaxis._ticks[0].formatter;var h=q._yaxis._ticks[0].formatter;var E=q._xaxis._ticks[0].formatString;var s=q._yaxis._ticks[0].formatString;var z;var u=w(E,m.data[0]);var l=[];for(var B=1;B<t.yvalues+1;B++){l.push(h(s,m.data[B]))}if(typeof t.formatString==="string"){switch(t.tooltipAxes){case"both":case"xy":l.unshift(u);l.unshift(t.formatString);z=e.jqplot.sprintf.apply(e.jqplot.sprintf,l);break;case"yx":l.push(u);l.unshift(t.formatString);z=e.jqplot.sprintf.apply(e.jqplot.sprintf,l);break;case"x":z=e.jqplot.sprintf.apply(e.jqplot.sprintf,[t.formatString,u]);break;case"y":l.unshift(t.formatString);z=e.jqplot.sprintf.apply(e.jqplot.sprintf,l);break;default:l.unshift(u);l.unshift(t.formatString);z=e.jqplot.sprintf.apply(e.jqplot.sprintf,l);break}}else{switch(t.tooltipAxes){case"both":case"xy":z=u;for(var B=0;B<l.length;B++){z+=t.tooltipSeparator+l[B]}break;case"yx":z="";for(var B=0;B<l.length;B++){z+=l[B]+t.tooltipSeparator}z+=u;break;case"x":z=u;break;case"y":z=l.join(t.tooltipSeparator);break;default:z=u;for(var B=0;B<l.length;B++){z+=t.tooltipSeparator+l[B]}break}}}else{var z;if(typeof t.formatString==="string"){z=e.jqplot.sprintf.apply(e.jqplot.sprintf,[t.formatString].concat(m.data))}else{if(t.tooltipAxes=="both"||t.tooltipAxes=="xy"){z=e.jqplot.sprintf(t.tooltipFormatString,m.data[0])+t.tooltipSeparator+e.jqplot.sprintf(t.tooltipFormatString,m.data[1])}else{if(t.tooltipAxes=="yx"){z=e.jqplot.sprintf(t.tooltipFormatString,m.data[1])+t.tooltipSeparator+e.jqplot.sprintf(t.tooltipFormatString,m.data[0])}else{if(t.tooltipAxes=="x"){z=e.jqplot.sprintf(t.tooltipFormatString,m.data[0])}else{if(t.tooltipAxes=="y"){z=e.jqplot.sprintf(t.tooltipFormatString,m.data[1])}}}}}}if(e.isFunction(t.tooltipContentEditor)){z=t.tooltipContentEditor(z,m.seriesIndex,m.pointIndex,A)}D.html(z);var C={x:m.gridData[0],y:m.gridData[1]};var v=0;var j=0.707;if(q.markerRenderer.show==true){v=(q.markerRenderer.size+t.sizeAdjust)/2}var o=b;if(q.fillToZero&&q.fill&&m.data[1]<0){o=d}switch(o[f[t.tooltipLocation]]){case"nw":var p=C.x+A._gridPadding.left-D.outerWidth(true)-t.tooltipOffset-j*v;var n=C.y+A._gridPadding.top-t.tooltipOffset-D.outerHeight(true)-j*v;break;case"n":var p=C.x+A._gridPadding.left-D.outerWidth(true)/2;var n=C.y+A._gridPadding.top-t.tooltipOffset-D.outerHeight(true)-v;break;case"ne":var p=C.x+A._gridPadding.left+t.tooltipOffset+j*v;var n=C.y+A._gridPadding.top-t.tooltipOffset-D.outerHeight(true)-j*v;break;case"e":var p=C.x+A._gridPadding.left+t.tooltipOffset+v;var n=C.y+A._gridPadding.top-D.outerHeight(true)/2;break;case"se":var p=C.x+A._gridPadding.left+t.tooltipOffset+j*v;var n=C.y+A._gridPadding.top+t.tooltipOffset+j*v;break;case"s":var p=C.x+A._gridPadding.left-D.outerWidth(true)/2;var n=C.y+A._gridPadding.top+t.tooltipOffset+v;break;case"sw":var p=C.x+A._gridPadding.left-D.outerWidth(true)-t.tooltipOffset-j*v;var n=C.y+A._gridPadding.top+t.tooltipOffset+j*v;break;case"w":var p=C.x+A._gridPadding.left-D.outerWidth(true)-t.tooltipOffset-v;var n=C.y+A._gridPadding.top-D.outerHeight(true)/2;break;default:var p=C.x+A._gridPadding.left-D.outerWidth(true)-t.tooltipOffset-j*v;var n=C.y+A._gridPadding.top-t.tooltipOffset-D.outerHeight(true)-j*v;break}D.css("left",p);D.css("top",n);if(t.fadeTooltip){D.stop(true,true).fadeIn(t.tooltipFadeSpeed)}else{D.show()}D=null}function c(n,j,i,p,l){var h=l.plugins.permHighlighter;var m=l.plugins.cursor;if(h.show){if(p!=null&&l.series[p.seriesIndex].showHighlight&&!h.isHighlighting){var o=jQuery.Event("jqplotPermHighlighterHighlight");o.which=n.which;o.pageX=n.pageX;o.pageY=n.pageY;var k=[p.seriesIndex,p.pointIndex,p.data,l];l.target.trigger(o,k);h.highlight(p,l)}else{if(p!=null&&h.isHighlighting&&h.currentNeighbor!=p){if(l.series[p.seriesIndex].showHighlight){var q=h.highlightCanvas._ctx;q.clearRect(0,0,q.canvas.width,q.canvas.height);h.highlight(p,l)}}}}}})(window.jQuery);